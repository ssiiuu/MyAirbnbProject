{"version":3,"file":"popover.esm.js","sources":["../src/styles.tsx","../src/Popover.tsx"],"sourcesContent":["export type StylesKeys = 'popover'\n\nexport type StylesObj = {\n  [key in StylesKeys]?: StyleFn\n}\n\nexport type StyleFn = (\n  props: { [key: string]: any },\n  state?: { [key: string]: any }\n) => React.CSSProperties\n\nexport type Styles = {\n  popover: StyleFn\n}\n\nexport type StyleKey = keyof Styles\n\nexport const defaultStyles: Styles = {\n  popover: () => ({\n    position: 'fixed',\n    maxWidth: 353,\n    // minWidth: 150,\n    backgroundColor: '#fff',\n    padding: '24px 30px',\n    boxShadow: '0 0.5em 3em rgba(0, 0, 0, 0.3)',\n    color: 'inherit',\n    zIndex: 100000,\n    transition: 'transform 0.3s',\n    top: 0,\n    left: 0,\n  }),\n}\n\nexport type getStylesType = (key: StylesKeys, extra?: any) => {}\n\nexport function stylesMatcher(styles: StylesObj) {\n  return (key: StyleKey, state: {}): {} => {\n    const base = defaultStyles[key](state)\n    const custom = styles[key]\n    return custom ? custom(base, state) : base\n  }\n}\n","/** @jsx jsx */ import { jsx } from '@emotion/react'\nimport React, { useRef } from 'react'\nimport {\n  useRect,\n  isHoriz,\n  bestPositionOf,\n  isOutsideX,\n  isOutsideY,\n  PositionsObjectType,\n  CoordsObjectType,\n  CoordType,\n  getWindow,\n  getPadding,\n  RectResult,\n} from '@reactour/utils'\n\nimport { StylesObj, stylesMatcher } from './styles'\n\nconst Popover: React.FC<PopoverProps> = ({\n  children,\n  position: providedPosition = 'bottom',\n  padding = 10,\n  styles = {},\n  sizes,\n  refresher,\n  ...props\n}) => {\n  const helperRef = useRef(null)\n  const positionRef = useRef('')\n  const verticalAlignRef = useRef('')\n  const horizontalAlignRef = useRef('')\n  const { w: windowWidth, h: windowHeight } = getWindow()\n  const getStyles = stylesMatcher(styles)\n\n  const { width: helperWidth, height: helperHeight } = useRect(\n    helperRef,\n    refresher\n  )\n\n  const targetLeft = sizes?.left\n  const targetTop = sizes?.top\n  const targetRight = sizes?.right\n  const targetBottom = sizes?.bottom\n\n  const position =\n    providedPosition && typeof providedPosition === 'function'\n      ? providedPosition({\n          width: helperWidth,\n          height: helperHeight,\n          windowWidth,\n          windowHeight,\n          top: targetTop,\n          left: targetLeft,\n          right: targetRight,\n          bottom: targetBottom,\n        })\n      : providedPosition\n\n  const available: PositionsObjectType = {\n    left: targetLeft,\n    right: windowWidth - targetRight,\n    top: targetTop,\n    bottom: windowHeight - targetBottom,\n  }\n\n  const [px, py] = getPadding(padding)\n\n  const couldPositionAt = (position: string) => {\n    return (\n      available[position] >\n      (isHoriz(position) ? helperWidth + px * 2 : helperHeight + py * 2)\n    )\n  }\n\n  const autoPosition = (coords: CoordsObjectType): CoordType => {\n    const positionsOrder: string[] = bestPositionOf(available)\n    for (let j = 0; j < positionsOrder.length; j++) {\n      if (couldPositionAt(positionsOrder[j])) {\n        positionRef.current = positionsOrder[j]\n        return coords[positionsOrder[j]]\n      }\n    }\n    positionRef.current = 'center'\n    return coords.center\n  }\n\n  const pos = (helperPosition: Position) => {\n    if (Array.isArray(helperPosition)) {\n      const isOutX = isOutsideX(helperPosition[0], windowWidth)\n      const isOutY = isOutsideY(helperPosition[1], windowHeight)\n\n      // if (isOutX) warn('x', helperPosition[0])\n      // if (isOutY) warn('y', helperPosition[1])\n      positionRef.current = 'custom'\n      return [\n        isOutX ? windowWidth / 2 - helperWidth / 2 : helperPosition[0],\n        isOutY ? windowHeight / 2 - helperHeight / 2 : helperPosition[1],\n      ]\n    }\n\n    const hX = isOutsideX(targetLeft + helperWidth, windowWidth)\n      ? targetRight - helperWidth + px\n      : targetLeft - px\n    const x = hX > px ? hX : px\n    const hY = isOutsideY(targetTop + helperHeight, windowHeight)\n      ? targetBottom - helperHeight + py\n      : targetTop - py\n    const y = hY > py ? hY : py\n\n    if (isOutsideY(targetTop + helperHeight, windowHeight)) {\n      verticalAlignRef.current = 'bottom'\n    } else {\n      verticalAlignRef.current = 'top'\n    }\n    if (isOutsideX(targetLeft + helperWidth, windowWidth)) {\n      horizontalAlignRef.current = 'left'\n    } else {\n      horizontalAlignRef.current = 'right'\n    }\n\n    const coords = {\n      top: [x, targetTop - helperHeight - py * 2],\n      right: [targetRight + px * 2, y],\n      bottom: [x, targetBottom + py * 2],\n      left: [targetLeft - helperWidth - px * 2, y],\n      center: [\n        windowWidth / 2 - helperWidth / 2,\n        windowHeight / 2 - helperHeight / 2,\n      ],\n    }\n    if (helperPosition === 'center' || couldPositionAt(helperPosition)) {\n      positionRef.current = helperPosition\n      return coords[helperPosition]\n    }\n    return autoPosition(coords)\n  }\n\n  const p = pos(position)\n\n  return (\n    <div\n      css={{\n        ...getStyles('popover', {\n          position: positionRef.current,\n          verticalAlign: verticalAlignRef.current,\n          horizontalAlign: horizontalAlignRef.current,\n        }),\n        transform: `translate(${Math.round(p[0])}px, ${Math.round(p[1])}px)`,\n      }}\n      ref={helperRef}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\nexport default Popover\n\nexport type PopoverProps = {\n  sizes: RectResult\n  children?: React.ReactNode\n  position?: PositionType\n  padding?: number | [number, number]\n  styles?: StylesObj\n  className?: string\n  refresher?: any\n}\n\nexport type PositionType =\n  | Position\n  | ((postionsProps: PositionProps) => Position)\n\nexport type PositionProps = RectResult & {\n  windowWidth: number\n  windowHeight: number\n}\n\nexport type Position =\n  | 'top'\n  | 'right'\n  | 'bottom'\n  | 'left'\n  | 'center'\n  | [number, number]\n\n// const warn = (axis: 'x' | 'y', num: number) => {\n//   console.warn(`${axis}:${num} is outside window, falling back to center`)\n// }\n"],"names":["defaultStyles","popover","position","maxWidth","backgroundColor","padding","boxShadow","color","zIndex","transition","top","left","stylesMatcher","styles","key","state","base","custom","Popover","children","providedPosition","sizes","refresher","props","helperRef","useRef","positionRef","verticalAlignRef","horizontalAlignRef","getWindow","windowWidth","w","windowHeight","h","getStyles","useRect","helperWidth","width","helperHeight","height","targetLeft","targetTop","targetRight","right","targetBottom","bottom","available","getPadding","px","py","couldPositionAt","isHoriz","autoPosition","coords","positionsOrder","bestPositionOf","j","length","current","center","pos","helperPosition","Array","isArray","isOutX","isOutsideX","isOutY","isOutsideY","hX","x","hY","y","p","jsx","css","verticalAlign","horizontalAlign","transform","Math","round","ref"],"mappings":"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"}